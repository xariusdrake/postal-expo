{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"/Users/nemonodoy/DATA/Source/PostalCode/postal-mobile/screens/postal/scanQR.js\";\nimport React, { useState, useEffect } from \"react\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport ImageBackground from \"react-native-web/dist/exports/ImageBackground\";\nimport TouchableWithoutFeedback from \"react-native-web/dist/exports/TouchableWithoutFeedback\";\nimport Keyboard from \"react-native-web/dist/exports/Keyboard\";\nimport KeyboardAvoidingView from \"react-native-web/dist/exports/KeyboardAvoidingView\";\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport * as Permissions from \"expo-permissions\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport { useQuery, useLazyQuery } from \"@apollo/client\";\nimport { Button } from \"@ui-kitten/components\";\nimport { BarCodeScanner } from \"expo-barcode-scanner\";\nimport appConfigs from \"../../config\";\nimport { Ionicons } from \"@expo/vector-icons\";\nimport ScanSVG from \"../../components/ScanSVG\";\nimport { QUERY_GET_POSTAL_BY_BARCODE } from \"../../graphql/query\";\n\nfunction ScanQRScreen(props) {\n  var _useLazyQuery = useLazyQuery(QUERY_GET_POSTAL_BY_BARCODE, {\n    onCompleted: function onCompleted() {\n      console.log(\"onCompleted\");\n      console.log(dataPostal);\n\n      if (dataPostal.postals.length > 0) {\n        navigation.navigate(\"Postal\", {\n          postal: dataPostal.postals[0]\n        });\n      } else {\n        console.log(\"không tìm được\");\n        setScanned(true);\n        setScanMode(false);\n        setNoResultFound(true);\n      }\n    },\n    onError: function onError() {\n      console.log(\"onError\");\n      console.log(errorPostal);\n    }\n  }),\n      _useLazyQuery2 = _slicedToArray(_useLazyQuery, 2),\n      getPostal = _useLazyQuery2[0],\n      _useLazyQuery2$ = _useLazyQuery2[1],\n      networkStatus = _useLazyQuery2$.networkStatus,\n      errorPostal = _useLazyQuery2$.error,\n      calledPostal = _useLazyQuery2$.called,\n      loadingPostal = _useLazyQuery2$.loading,\n      dataPostal = _useLazyQuery2$.data;\n\n  var navigation = useNavigation();\n  var windowHeight = Dimensions.get(\"window\").height;\n  var windowWidth = Dimensions.get(\"window\").width;\n\n  var _useState = useState(true),\n      _useState2 = _slicedToArray(_useState, 2),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      clicked = _useState4[0],\n      setClicked = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      scanMode = _useState6[0],\n      setScanMode = _useState6[1];\n\n  var _useState7 = useState(null),\n      _useState8 = _slicedToArray(_useState7, 2),\n      hasPermission = _useState8[0],\n      setHasPermission = _useState8[1];\n\n  var _useState9 = useState(false),\n      _useState10 = _slicedToArray(_useState9, 2),\n      scanned = _useState10[0],\n      setScanned = _useState10[1];\n\n  var _useState11 = useState(false),\n      _useState12 = _slicedToArray(_useState11, 2),\n      loader = _useState12[0],\n      setLoader = _useState12[1];\n\n  var _useState13 = useState(false),\n      _useState14 = _slicedToArray(_useState13, 2),\n      noResultFound = _useState14[0],\n      setNoResultFound = _useState14[1];\n\n  function askPermissions() {\n    var response;\n    return _regeneratorRuntime.async(function askPermissions$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(Permissions.askAsync(Permissions.CAMERA));\n\n          case 2:\n            response = _context.sent;\n            console.log(\"askPermissions CAMERA\");\n            console.log(response);\n\n            if (response.status == \"granted\") {\n              setHasPermission(true);\n            } else {\n              setHasPermission(false);\n              Alert.alert(\"Quyền truy cập Camera không được cấp. Vào cài đặt để đặt lại.\");\n              setClicked(false);\n            }\n\n            setLoading(false);\n\n          case 7:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  useEffect(function () {\n    askPermissions();\n  }, []);\n\n  if (!scanned) {\n    var layerView = React.createElement(View, {\n      style: stylesX.loadingView,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 4\n      }\n    }, React.createElement(Text, {\n      style: {\n        color: \"white\",\n        fontWeight: \"bold\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 5\n      }\n    }, \" \\u0110ang t\\xECm\"));\n  }\n\n  if (!scanned) {\n    var layerView = React.createElement(View, {\n      style: {\n        position: \"absolute\",\n        height: \"100%\",\n        top: 0,\n        flex: 1,\n        flexDirection: \"column\",\n        justifyContent: \"space-between\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 4\n      }\n    }, React.createElement(View, {\n      style: {\n        width: windowWidth,\n        flexGrow: 1,\n        justifyContent: \"center\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 5\n      }\n    }, React.createElement(TouchableOpacity, {\n      onPress: function onPress() {\n        setScanMode(false);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 6\n      }\n    }, React.createElement(Ionicons, {\n      name: \"md-close\",\n      size: 34,\n      color: \"#1da1f2\",\n      style: {\n        textAlign: \"right\",\n        marginRight: 34\n      },\n      onPress: function onPress() {\n        return navigation.navigate(\"Explore\");\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 7\n      }\n    }))), React.createElement(View, {\n      style: {\n        width: windowWidth,\n        flexGrow: 12,\n        flex: 1,\n        justifyContent: \"center\",\n        alignItems: \"center\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 5\n      }\n    }, React.createElement(ScanSVG, {\n      style: {\n        color: '#1da1f2',\n        borderColor: '#1da1f2'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 6\n      }\n    })), React.createElement(View, {\n      style: {\n        width: windowWidth,\n        flexGrow: 1\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 5\n      }\n    }, React.createElement(Text, {\n      style: {\n        height: 34\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 6\n      }\n    })));\n  }\n\n  var handleBarCodeScanned = function handleBarCodeScanned(_ref) {\n    var type, data;\n    return _regeneratorRuntime.async(function handleBarCodeScanned$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            type = _ref.type, data = _ref.data;\n\n            if (!(scanned == true)) {\n              _context2.next = 4;\n              break;\n            }\n\n            console.log(\"đã scan\");\n            return _context2.abrupt(\"return\");\n\n          case 4:\n            console.log(236, type, data);\n            setScanned(true);\n            setLoader(true);\n\n            if (!(loadingPostal == 1)) {\n              _context2.next = 10;\n              break;\n            }\n\n            console.log(\"stop. đã load postal\");\n            return _context2.abrupt(\"return\");\n\n          case 10:\n            getPostal({\n              variables: {\n                id: data\n              }\n            });\n\n          case 11:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  if (loading == false && (hasPermission === false || hasPermission == null)) {\n    return React.createElement(View, {\n      style: {\n        position: \"absolute\",\n        height: \"100%\",\n        top: 0,\n        flex: 1,\n        flexDirection: \"column\",\n        justifyContent: \"space-between\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 4\n      }\n    }, React.createElement(View, {\n      style: {\n        width: windowWidth,\n        flexGrow: 1,\n        justifyContent: \"center\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 5\n      }\n    }, React.createElement(TouchableOpacity, {\n      onPress: function onPress() {\n        setScanMode(false);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 6\n      }\n    }, React.createElement(Ionicons, {\n      name: \"md-close\",\n      size: 34,\n      color: \"#2DB08C\",\n      style: {\n        textAlign: \"right\",\n        marginRight: 34\n      },\n      onPress: function onPress() {\n        return navigation.navigate(\"Explore\");\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 7\n      }\n    }))), React.createElement(View, {\n      style: {\n        flex: 1,\n        flexDirection: \"column\",\n        justifyContent: \"flex-end\",\n        justifyContent: \"center\",\n        alignItems: \"center\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 5\n      }\n    }, React.createElement(Text, {\n      style: {\n        paddingBottom: 20\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 6\n      }\n    }, \"Kh\\xF4ng th\\u1EC3 truy c\\u1EADp camera\"), React.createElement(Button, {\n      onPress: function onPress() {\n        console.log(clicked);\n        setClicked(true);\n        askPermissions();\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 6\n      }\n    }, \"C\\u1EA5p quy\\u1EC1n CAMERA\")), React.createElement(View, {\n      style: {\n        width: windowWidth,\n        flexGrow: 1\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 5\n      }\n    }, React.createElement(Text, {\n      style: {\n        height: 34\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 259,\n        columnNumber: 6\n      }\n    })));\n  }\n\n  return React.createElement(View, {\n    style: {\n      flex: 1,\n      flexDirection: \"column\",\n      justifyContent: \"flex-end\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 3\n    }\n  }, React.createElement(BarCodeScanner, {\n    onBarCodeScanned: scanned ? undefined : handleBarCodeScanned,\n    style: StyleSheet.absoluteFillObject,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 273,\n      columnNumber: 4\n    }\n  }), layerView, scanned && React.createElement(Button, {\n    onPress: function onPress() {\n      setScanned(false);\n      setLoader(false);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 282,\n      columnNumber: 5\n    }\n  }, \"Qu\\xE9t l\\u1EA1i\"));\n}\n\nvar stylesX = StyleSheet.create({\n  container: {\n    flex: 1,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    paddingHorizontal: 25,\n    backgroundColor: \"#FFFFFF\"\n  },\n  loadingView: {\n    flex: 1,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    backgroundColor: \"transparent\"\n  }\n});\nexport default ScanQRScreen;","map":{"version":3,"sources":["/Users/nemonodoy/DATA/Source/PostalCode/postal-mobile/screens/postal/scanQR.js"],"names":["React","useState","useEffect","Permissions","useNavigation","useQuery","useLazyQuery","Button","BarCodeScanner","appConfigs","Ionicons","ScanSVG","QUERY_GET_POSTAL_BY_BARCODE","ScanQRScreen","props","onCompleted","console","log","dataPostal","postals","length","navigation","navigate","postal","setScanned","setScanMode","setNoResultFound","onError","errorPostal","getPostal","networkStatus","error","calledPostal","called","loadingPostal","loading","data","windowHeight","Dimensions","get","height","windowWidth","width","setLoading","clicked","setClicked","scanMode","hasPermission","setHasPermission","scanned","loader","setLoader","noResultFound","askPermissions","askAsync","CAMERA","response","status","Alert","alert","layerView","stylesX","loadingView","color","fontWeight","position","top","flex","flexDirection","justifyContent","flexGrow","textAlign","marginRight","alignItems","borderColor","handleBarCodeScanned","type","variables","id","paddingBottom","undefined","StyleSheet","absoluteFillObject","create","container","paddingHorizontal","backgroundColor"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport {\n\tStyleSheet,\n\tText,\n\tImage,\n\tView,\n\tTouchableOpacity,\n\tImageBackground,\n\tTouchableWithoutFeedback,\n\tKeyboard,\n\tKeyboardAvoidingView,\n\tDimensions,\n\tAlert,\n} from \"react-native\";\nimport * as Permissions from \"expo-permissions\";\n\nimport { useNavigation } from \"@react-navigation/native\";\nimport { useQuery, useLazyQuery } from \"@apollo/client\";\nimport { Button } from \"@ui-kitten/components\";\n\nimport { BarCodeScanner } from \"expo-barcode-scanner\";\nimport appConfigs from \"../../config\";\n\nimport { Ionicons } from \"@expo/vector-icons\";\nimport ScanSVG from \"../../components/ScanSVG\";\n\nimport { QUERY_GET_POSTAL_BY_BARCODE } from \"../../graphql/query\";\n\n\nfunction ScanQRScreen(props) {\n\tconst [\n\t\tgetPostal,\n\t\t{\n\t\t\tnetworkStatus,\n\t\t\terror: errorPostal,\n\t\t\tcalled: calledPostal,\n\t\t\tloading: loadingPostal,\n\t\t\tdata: dataPostal,\n\t\t},\n\t] = useLazyQuery(QUERY_GET_POSTAL_BY_BARCODE, {\n\t\tonCompleted: () => {\n\t\t\tconsole.log(\"onCompleted\");\n\t\t\tconsole.log(dataPostal);\n\t\t\t// console.log(dataPostal.postals[0].id)\n\n\t\t\tif (dataPostal.postals.length > 0) {\n\t\t\t\tnavigation.navigate(\"Postal\", {\n\t\t\t\t\tpostal: dataPostal.postals[0],\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconsole.log(\"không tìm được\");\n\t\t\t\tsetScanned(true);\n\t\t\t\tsetScanMode(false);\n\t\t\t\tsetNoResultFound(true);\n\t\t\t}\n\t\t},\n\t\tonError: () => {\n\t\t\tconsole.log(\"onError\");\n\t\t\tconsole.log(errorPostal);\n\t\t},\n\t});\n\n\tconst navigation = useNavigation();\n\n\tconst windowHeight = Dimensions.get(\"window\").height;\n\tconst windowWidth = Dimensions.get(\"window\").width;\n\n\tconst [loading, setLoading] = useState(true);\n\tconst [clicked, setClicked] = useState(false);\n\n\tconst [scanMode, setScanMode] = useState(false);\n\tconst [hasPermission, setHasPermission] = useState(null);\n\tconst [scanned, setScanned] = useState(false);\n\tconst [loader, setLoader] = useState(false);\n\tconst [noResultFound, setNoResultFound] = useState(false);\n\n\t// const [permission, askForPermission] = usePermissions(Permissions.CAMERA, { ask: true });\n\t// const [searchResult, setSearchResult] = useState();\n\n\t// async function ifDisablePermissionCamera() {\n\t// \tconst { status } = await Permissions.getAsync(Permissions.CAMERA);\n\n\t// \tif (status !== \"granted\") {\n\t// \t\tsetHasPermission(false);\n\t// \t}\n\t// }\n\n\tasync function askPermissions() {\n\t\t// console.log('#6 demande la permision')\n\t\tvar response = await Permissions.askAsync(Permissions.CAMERA);\n\n\t\tconsole.log(\"askPermissions CAMERA\");\n\t\tconsole.log(response);\n\n\t\tif (response.status == \"granted\") {\n\t\t\tsetHasPermission(true);\n\t\t} else {\n\t\t\tsetHasPermission(false);\n\n\t\t\t// if (clicked == true) {\n\t\t\t\tAlert.alert(\n\t\t\t\t\t\"Quyền truy cập Camera không được cấp. Vào cài đặt để đặt lại.\"\n\t\t\t\t);\n\t\t\t\tsetClicked(false);\n\t\t\t// }\n\t\t}\n\n\t\tsetLoading(false);\n\t}\n\n\tuseEffect(() => {\n\t\t// ifDisablePermissionCamera();\n\t\taskPermissions();\n\t}, []);\n\n\tif (!scanned) {\n\t\tvar layerView = (\n\t\t\t<View style={stylesX.loadingView}>\n\t\t\t\t<Text style={{ color: \"white\", fontWeight: \"bold\" }}> Đang tìm</Text>\n\t\t\t</View>\n\t\t);\n\t}\n\n\tif (!scanned) {\n\t\tvar layerView = (\n\t\t\t<View\n\t\t\t\tstyle={{\n\t\t\t\t\tposition: \"absolute\",\n\t\t\t\t\theight: \"100%\",\n\t\t\t\t\ttop: 0,\n\t\t\t\t\tflex: 1,\n\t\t\t\t\tflexDirection: \"column\",\n\t\t\t\t\tjustifyContent: \"space-between\",\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<View\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\twidth: windowWidth,\n\t\t\t\t\t\tflexGrow: 1,\n\t\t\t\t\t\tjustifyContent: \"center\",\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<TouchableOpacity\n\t\t\t\t\t\tonPress={() => {\n\t\t\t\t\t\t\tsetScanMode(false);\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Ionicons\n\t\t\t\t\t\t\tname=\"md-close\"\n\t\t\t\t\t\t\tsize={34}\n\t\t\t\t\t\t\tcolor={\"#1da1f2\"}\n\t\t\t\t\t\t\tstyle={{ textAlign: \"right\", marginRight: 34 }}\n\t\t\t\t\t\t\tonPress={() => navigation.navigate(\"Explore\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</TouchableOpacity>\n\t\t\t\t</View>\n\t\t\t\t<View\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\twidth: windowWidth,\n\t\t\t\t\t\tflexGrow: 12,\n\t\t\t\t\t\tflex: 1,\n\t\t\t\t\t\tjustifyContent: \"center\",\n\t\t\t\t\t\talignItems: \"center\",\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<ScanSVG style={{ color: '#1da1f2', borderColor: '#1da1f2' }}/>\n\t\t\t\t</View>\n\t\t\t\t<View style={{ width: windowWidth, flexGrow: 1 }}>\n\t\t\t\t\t<Text style={{ height: 34 }}></Text>\n\t\t\t\t</View>\n\t\t\t</View>\n\t\t);\n\t}\n\n\t// successfully scan something\n\tconst handleBarCodeScanned = async ({ type, data }) => {\n\t\tif (scanned == true) {\n\t\t\tconsole.log(\"đã scan\");\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.log(236, type, data);\n\n\t\tsetScanned(true);\n\t\tsetLoader(true);\n\n\t\tif (loadingPostal == 1) {\n\t\t\tconsole.log(\"stop. đã load postal\");\n\t\t\treturn;\n\t\t}\n\t\tgetPostal({ variables: { id: data } });\n\t};\n\n\t// if (!permission || permission.status !== \"granted\") {\n\t// \treturn (\n\t// \t\t<View>\n\t// \t\t\t<Text>Vui lòng cấp quyền truy cập camera</Text>\n\t// \t\t\t<Button title=\"Đặt lại quyền\" onPress={askForPermission} />\n\t// \t\t</View>\n\t// \t);\n\t// }\n\n\tif (loading == false && (hasPermission === false || hasPermission == null)) {\n\t\treturn (\n\t\t\t<View\n\t\t\t\tstyle={{\n\t\t\t\t\tposition: \"absolute\",\n\t\t\t\t\theight: \"100%\",\n\t\t\t\t\ttop: 0,\n\t\t\t\t\tflex: 1,\n\t\t\t\t\tflexDirection: \"column\",\n\t\t\t\t\tjustifyContent: \"space-between\",\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<View\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\twidth: windowWidth,\n\t\t\t\t\t\tflexGrow: 1,\n\t\t\t\t\t\tjustifyContent: \"center\",\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<TouchableOpacity\n\t\t\t\t\t\tonPress={() => {\n\t\t\t\t\t\t\tsetScanMode(false);\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Ionicons\n\t\t\t\t\t\t\tname=\"md-close\"\n\t\t\t\t\t\t\tsize={34}\n\t\t\t\t\t\t\tcolor={\"#2DB08C\"}\n\t\t\t\t\t\t\tstyle={{ textAlign: \"right\", marginRight: 34 }}\n\t\t\t\t\t\t\tonPress={() => navigation.navigate(\"Explore\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</TouchableOpacity>\n\t\t\t\t</View>\n\n\t\t\t\t<View\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tflex: 1,\n\t\t\t\t\t\tflexDirection: \"column\",\n\t\t\t\t\t\tjustifyContent: \"flex-end\",\n\t\t\t\t\t\tjustifyContent: \"center\",\n\t\t\t\t\t\talignItems: \"center\",\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<Text style={{ paddingBottom: 20 }}>Không thể truy cập camera</Text>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tonPress={() => {\n\t\t\t\t\t\t\tconsole.log(clicked);\n\t\t\t\t\t\t\tsetClicked(true);\n\t\t\t\t\t\t\taskPermissions();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\tCấp quyền CAMERA\n\t\t\t\t\t</Button>\n\t\t\t\t</View>\n\n\t\t\t\t<View style={{ width: windowWidth, flexGrow: 1 }}>\n\t\t\t\t\t<Text style={{ height: 34 }}></Text>\n\t\t\t\t</View>\n\t\t\t</View>\n\t\t);\n\t}\n\n\treturn (\n\t\t<View\n\t\t\tstyle={{\n\t\t\t\tflex: 1,\n\t\t\t\tflexDirection: \"column\",\n\t\t\t\tjustifyContent: \"flex-end\",\n\t\t\t}}\n\t\t>\n\t\t\t<BarCodeScanner\n\t\t\t\tonBarCodeScanned={scanned ? undefined : handleBarCodeScanned}\n\t\t\t\tstyle={StyleSheet.absoluteFillObject}\n\t\t\t/>\n\t\t\t{layerView}\n\n\t\t\t{/* <----- afficher un loader while on cherche dans la BDD */}\n\n\t\t\t{scanned && (\n\t\t\t\t<Button\n\t\t\t\t\tonPress={() => {\n\t\t\t\t\t\tsetScanned(false);\n\t\t\t\t\t\tsetLoader(false);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\tQuét lại\n\t\t\t\t</Button>\n\t\t\t)}\n\t\t</View>\n\t);\n}\n\nconst stylesX = StyleSheet.create({\n\tcontainer: {\n\t\tflex: 1,\n\t\tjustifyContent: \"center\",\n\t\talignItems: \"center\",\n\t\tpaddingHorizontal: 25,\n\t\tbackgroundColor: \"#FFFFFF\",\n\t},\n\tloadingView: {\n\t\tflex: 1,\n\t\tjustifyContent: \"center\",\n\t\talignItems: \"center\",\n\t\tbackgroundColor: \"transparent\",\n\t},\n});\n\nexport default ScanQRScreen;\n"]},"metadata":{},"sourceType":"module"}